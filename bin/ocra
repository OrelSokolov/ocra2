#!/usr/bin/env ruby
# -*- ruby -*-
# encoding: UTF-8

require 'bundler/setup'
require 'ocra'

if File.basename(__FILE__) == File.basename($0)
  Ocra.init(ARGV)
  ARGV.replace(Ocra.arg)

  if not Ocra.files.first.exist?
    Ocra.fatal_error "#{Ocra.files[0]} was not found!"
  end

  at_exit do
    if $!.nil? or $!.kind_of?(SystemExit)
      Ocra.build_exe
      exit 0
    end
  end

  if Ocra.run_script
    Ocra.msg "Loading script to check dependencies"
    $0 = Ocra.files.first
    load Ocra.files.first
  end
end
